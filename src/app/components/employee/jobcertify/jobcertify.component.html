<igb-navbar></igb-navbar>

<div class="container content">
  <h3>Generar Carta Laboral</h3>
  <div class="alert alert-danger text-center error-alert" role="alert" *ngIf="errorMessage">
    {{errorMessage}}
  </div>
  <div class="alert alert-success success-alert" role="alert" *ngIf="successMessage">
    {{successMessage}}
  </div>
  <div class="main-container">
    <div class="tarjeta-ingreso-agrupada">
      <div class="ingreso-card">
        <h4>Datos del Solicitante</h4>
        <table class="table">
          <tr>
            <th>Número Documento</th>
            <td>
              <input type="number" class="form-control" [(ngModel)]="cedula" name="cedula"
                placeholder="Ingrese su documento" required [disabled]="formLocked" />
            </td>
          </tr>
          <tr>
            <th>Empresa</th>
            <td>
              <select class="form-control" [(ngModel)]="selectedCompany" name="empresa"
                (ngModelChange)="onCompanyChange()" required [disabled]="formLocked">
                <option value="" disabled>Seleccione empresa</option>
                <option value="IGB_NOVAWEB">IGB</option>
                <option value="MTZ_NOVAWEB">MOTOZONE</option>
                <option value="WALI_NOVAWEB">WALI</option>
                <option value="DSM_NOVAWEB">DIGITAL</option>
                <option value="INVERSUR_NOVAWEB">INVERSUR</option>
                <option value="MOTOREPUESTOS_NOVAWEB">MOTOREPUESTOS</option>
              </select>
            </td>
          </tr>
          <tr>
            <th>Mes / Año</th>
            <td colspan="3">
              <div class="fila-doble">
                <select class="form-control" [(ngModel)]="selectedMonth" name="selectedMonth" disabled>
                  <option [value]="selectedMonth">
                    {{selectedMonth === '01' ? 'Enero' :
                    selectedMonth === '02' ? 'Febrero' :
                    selectedMonth === '03' ? 'Marzo' :
                    selectedMonth === '04' ? 'Abril' :
                    selectedMonth === '05' ? 'Mayo' :
                    selectedMonth === '06' ? 'Junio' :
                    selectedMonth === '07' ? 'Julio' :
                    selectedMonth === '08' ? 'Agosto' :
                    selectedMonth === '09' ? 'Septiembre' :
                    selectedMonth === '10' ? 'Octubre' :
                    selectedMonth === '11' ? 'Noviembre' : 'Diciembre'}}
                  </option>
                </select>
                <select class="form-control" [(ngModel)]="selectedYear" name="selectedYear" disabled>
                  <option [value]="selectedYear">{{selectedYear}}</option>
                </select>
              </div>
            </td>
          </tr>
          <tr>
            <th>Fecha Nacimiento</th>
            <td colspan="3">
              <input type="date" class="form-control" [(ngModel)]="fechaNacimiento" name="fechaNacimiento" required
                [disabled]="formLocked" />
            </td>
          </tr>
          <tr>
            <th>Tipo</th>
            <td colspan="3">
              <select class="form-control" [(ngModel)]="selectedPeriodo" name="selectedPeriodo" required
                [disabled]="formLocked">
                <option value="" disabled>Seleccione uno</option>
                <option value="15">ADMINISTRATIVO</option>
                <option value="30">LOGISTICA</option>
              </select>
            </td>
          </tr>
          <tr>
            <th>Dirigido A</th>
            <td colspan="3">
              <select class="form-control" [(ngModel)]="dirigidoA" name="dirigidoA" required [disabled]="formLocked">
                <option value="" disabled selected>Seleccione uno</option>
                <option value="A quién pueda interesar">A QUIEN PUEDA INTERESAR</option>
                <option value="Personalizado">PERSONALIZADO</option>
              </select>
            </td>
          </tr>
          <tr *ngIf="dirigidoA === 'Personalizado'">
            <th>Entidad</th>
            <td colspan="3">
              <textarea class="form-control" [(ngModel)]="contenidoPersonalizado" name="contenidoPersonalizado" rows="2"
                placeholder="Escriba el destinatario" [disabled]="formLocked"
                (input)="contenidoPersonalizado = contenidoPersonalizado.toUpperCase()"
                style="text-transform: uppercase;"></textarea>
            </td>
          </tr>
        </table>
        <div class="employee-actions">
          <button type="button" class="btn btn-primary" (click)="mostrarResumen()"
            [disabled]="formLocked || !cedula || !selectedPeriodo || !fechaNacimiento || !dirigidoA || !selectedCompany">
            Generar
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelForm()" [disabled]="formLocked">
            Cancelar
          </button>
        </div>
      </div>
    </div>
    <div class="col-derecha" *ngIf="showResumen">
      <div class="card-box">
        <h4>DETALLES DE LA CARTA LABORAL</h4>
        <table class="table">
          <tr>
            <th>Documento</th>
            <td>{{cedula}}</td>
          </tr>
          <tr>
            <th>Empresa</th>
            <td>{{selectedCompanyPrint}}</td>
          </tr>
          <tr>
            <th>Dirigido a</th>
            <td>
              <span *ngIf="dirigidoA !== 'Personalizado'">{{dirigidoA}}</span>
              <span *ngIf="dirigidoA === 'Personalizado'">{{contenidoPersonalizado || '(sin texto)'}}</span>
            </td>
          </tr>
        </table>
        <div class="employee-actions">
          <button type="button" class="btn btn-success" (click)="generateJobCertify()">Confirmar</button>
          <button type="button" class="btn btn-secondary" (click)="editar()">Volver</button>
        </div>
      </div>
      <div class="global-info-box">
        <p>
          <strong>NOTA:</strong>
          La carta se liquida con la información del <strong>mes anterior</strong>
          ({{mesAnteriorLabel}}) por corte de nómina, pero el documento se emite con la
          <strong>fecha actual</strong>: {{today | date:'dd/MM/yyyy'}}.
        </p>
      </div>
    </div>
  </div>
</div>
